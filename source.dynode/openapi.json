{
  "openapi": "3.0.0",
  "info": {
    "title": "Source API",
    "version": "1.0.0",
    "description": "API documentation for Source endpoints"
  },
  "servers": [
    {
      "url": "http://localhost:3333",
      "description": "Primary server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "paths": {
    "/login": {
      "post": {
        "summary": "User login and JWT token generation",
        "tags": [
          "Authorization"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "required": [
                  "username",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "JWT token returned",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid credentials"
          }
        },
        "security": []
      }
    },
    "/files/log": {
      "post": {
        "summary": "Write a log entry",
        "tags": [
          "Files"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "string",
                    "enum": [
                      "info",
                      "error",
                      "warn",
                      "debug",
                      "http",
                      "verbose"
                    ],
                    "description": "Log level"
                  },
                  "message": {
                    "type": "string",
                    "description": "Log message"
                  },
                  "meta": {
                    "type": "object",
                    "description": "Additional metadata"
                  }
                },
                "required": [
                  "level",
                  "message"
                ]
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "Log entry written successfully"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "get": {
        "summary": "Query log entries with filters",
        "tags": [
          "Files"
        ],
        "parameters": [
          {
            "name": "userId",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by user ID"
          },
          {
            "name": "sessionId",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by session ID"
          },
          {
            "name": "startDate",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter logs from this date (ISO 8601 format)"
          },
          {
            "name": "endDate",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter logs until this date (ISO 8601 format)"
          },
          {
            "name": "level",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "error",
                "warn",
                "info",
                "http",
                "verbose",
                "debug"
              ]
            },
            "description": "Filter by single log level"
          },
          {
            "name": "levels",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by multiple log levels (comma-separated, e.g., 'error,warn')"
          },
          {
            "name": "message",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Case-insensitive text search in message field"
          },
          {
            "name": "meta",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Text search in meta field"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 100
            },
            "description": "Maximum number of results to return"
          },
          {
            "name": "skip",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 0
            },
            "description": "Number of results to skip (for pagination)"
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string",
              "default": "timestamp"
            },
            "description": "Field to sort by"
          },
          {
            "name": "order",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort order"
          }
        ],
        "responses": {
          "200": {
            "description": "Log query results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "level": {
                            "type": "string",
                            "enum": [
                              "error",
                              "warn",
                              "info",
                              "http",
                              "verbose",
                              "debug"
                            ]
                          },
                          "message": {
                            "type": "string"
                          },
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "origin": {
                            "type": "string"
                          },
                          "userId": {
                            "type": "string"
                          },
                          "sessionId": {
                            "type": "string"
                          },
                          "meta": {
                            "type": "object"
                          }
                        }
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "total": {
                          "type": "integer",
                          "description": "Total number of matching records"
                        },
                        "limit": {
                          "type": "integer",
                          "description": "Number of results requested"
                        },
                        "skip": {
                          "type": "integer",
                          "description": "Number of results skipped"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to query logs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "error": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/data/components": {
      "get": {
        "summary": "Get all components",
        "tags": [
          "Components"
        ],
        "parameters": [
          {
            "name": "type",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "The type of components to retrieve (e.g., 'layout', 'widget', etc.)."
          }
        ],
        "responses": {
          "200": {
            "description": "Components data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/components/{id}": {
      "get": {
        "summary": "Get identified component data",
        "tags": [
          "Components"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The component's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Component data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives/assemblies": {
      "get": {
        "summary": "Get assembled creatives data",
        "tags": [
          "Creatives: Assembled"
        ],
        "parameters": [
          {
            "name": "children",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "If true, include children in the response; if false, return only one level."
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "post": {
        "summary": "Post assembled creatives data",
        "tags": [
          "Creatives: Assembled"
        ],
        "responses": {
          "200": {
            "description": "Creatives data created"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "put": {
        "summary": "Put assembled creatives data",
        "tags": [
          "Creatives: Assembled"
        ],
        "responses": {
          "200": {
            "description": "Creatives data changed"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "delete": {
        "summary": "Delete assembled creatives data",
        "tags": [
          "Creatives: Assembled"
        ],
        "responses": {
          "200": {
            "description": "Creatives data deleted"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives/assemblies/{id}": {
      "get": {
        "summary": "Get assembled creative data",
        "tags": [
          "Creatives: Assembled"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          },
          {
            "name": "children",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "If true, include children in the response; if false, return only one level."
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives ZIP Package retrieved."
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "post": {
        "summary": "Build assembled creative ZIP package",
        "tags": [
          "Creatives: Assembled"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives ZIP Package built."
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives/dynamics": {
      "get": {
        "summary": "Get dynamic creatives data",
        "tags": [
          "Creatives: Dynamic"
        ],
        "parameters": [
          {
            "name": "children",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "If true, include children in the response; if false, return only one level."
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives/dynamics/{id}": {
      "get": {
        "summary": "Get dynamic creatives data",
        "tags": [
          "Creatives: Dynamic"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          },
          {
            "name": "children",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "If true, include children in the response; if false, return only one level."
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "post": {
        "summary": "Post dynamic creatives data",
        "tags": [
          "Creatives: Dynamic"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data created"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "put": {
        "summary": "Put dynamic creatives data",
        "tags": [
          "Creatives: Dynamic"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Fields to update in the creative document",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Creatives data changed"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "delete": {
        "summary": "Delete dynamic creatives data",
        "tags": [
          "Creatives: Dynamic"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data deleted"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives/interactives": {
      "get": {
        "summary": "Get interactive creatives data",
        "tags": [
          "Creatives: Interactive"
        ],
        "parameters": [
          {
            "name": "children",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "If true, include children in the response; if false, return only one level."
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "post": {
        "summary": "Post interactive creatives data",
        "tags": [
          "Creatives: Interactive"
        ],
        "responses": {
          "200": {
            "description": "Creatives data created"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "put": {
        "summary": "Put interactive creatives data",
        "tags": [
          "Creatives: Interactive"
        ],
        "responses": {
          "200": {
            "description": "Creatives data changed"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "delete": {
        "summary": "Delete interactive creatives data",
        "tags": [
          "Creatives: Interactive"
        ],
        "responses": {
          "200": {
            "description": "Creatives data deleted"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives": {
      "get": {
        "summary": "Get all creatives",
        "tags": [
          "Creatives"
        ],
        "parameters": [
          {
            "name": "children",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean"
            },
            "description": "If true, include children in the response; if false, return only one level."
          },
          {
            "name": "folder",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter creatives by folder ID",
            "example": "68a6d1718c127df5e97b6a8f"
          },
          {
            "name": "origin",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter creatives by origin",
            "example": "dynamics"
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/creatives/{id}": {
      "get": {
        "summary": "Get identified creative data",
        "tags": [
          "Creatives"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The creatives's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Creatives data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/elements": {
      "get": {
        "summary": "Get all elements",
        "tags": [
          "Elements"
        ],
        "parameters": [
          {
            "name": "mode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "assets",
                "binding"
              ],
              "default": ""
            },
            "description": "Select model/view for elements: empty (default) -> elementsCollection; 'assets' -> elementsAssetsView; 'binding' -> elementsBindingView"
          }
        ],
        "responses": {
          "200": {
            "description": "Elements data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/elements/{id}": {
      "get": {
        "summary": "Get identified element data",
        "tags": [
          "Elements"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The element's MongoDB _id"
          },
          {
            "name": "mode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "assets",
                "binding"
              ],
              "default": ""
            },
            "description": "Select model/view for elements: empty (default) -> elementsCollection; 'assets' -> elementsAssetsView; 'binding' -> elementsBindingView"
          }
        ],
        "responses": {
          "200": {
            "description": "Element data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/data/folders": {
      "get": {
        "summary": "Get all folders",
        "tags": [
          "Folders"
        ],
        "description": "Retrieve all folders for the current user/domain, sorted alphabetically by name",
        "responses": {
          "200": {
            "description": "List of folders retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Folder"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to retrieve folders"
          }
        }
      },
      "post": {
        "summary": "Create a new folder",
        "tags": [
          "Folders"
        ],
        "description": "Create a new folder with optional parent and color. Max depth is 3 levels (0=root, 1=child, 2=grandchild)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "The name of the folder",
                    "minLength": 1,
                    "maxLength": 50
                  },
                  "parent": {
                    "type": "string",
                    "description": "Parent folder ID (ObjectId). Omit for root-level folder",
                    "pattern": "^[0-9a-fA-F]{24}$"
                  },
                  "color": {
                    "type": "string",
                    "description": "Optional color code for the folder",
                    "pattern": "^#[0-9a-fA-F]{6}$"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Folder created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Folder"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid data or max depth exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Maximum folder depth (3 levels) exceeded."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Parent folder not found"
          },
          "500": {
            "description": "Failed to create folder"
          }
        }
      }
    },
    "/data/folders/{id}": {
      "get": {
        "summary": "Get a folder by ID",
        "tags": [
          "Folders"
        ],
        "description": "Retrieve a single folder by its ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "responses": {
          "200": {
            "description": "Folder retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Folder"
                }
              }
            }
          },
          "400": {
            "description": "Invalid folder ID"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Folder not found"
          },
          "500": {
            "description": "Failed to retrieve folder"
          }
        }
      },
      "put": {
        "summary": "Update a folder",
        "tags": [
          "Folders"
        ],
        "description": "Update folder name, parent, or color. Moving folders validates depth limits and prevents circular references",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Updated folder name",
                    "minLength": 1,
                    "maxLength": 50
                  },
                  "parent": {
                    "type": [
                      "string",
                      "null"
                    ],
                    "description": "New parent folder ID (ObjectId) or null to move to root",
                    "pattern": "^[0-9a-fA-F]{24}$"
                  },
                  "color": {
                    "type": [
                      "string",
                      "null"
                    ],
                    "description": "Updated color code or null to remove color",
                    "pattern": "^#[0-9a-fA-F]{6}$"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Folder updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Folder"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid data, circular reference, or max depth exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Cannot move folder to one of its descendants."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Folder or parent folder not found"
          },
          "500": {
            "description": "Failed to update folder"
          }
        }
      },
      "delete": {
        "summary": "Delete a folder",
        "tags": [
          "Folders"
        ],
        "description": "Delete a folder. Items in the folder remain, they just lose their folder reference. Cannot delete folders with subfolders",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "responses": {
          "204": {
            "description": "Folder deleted successfully"
          },
          "400": {
            "description": "Cannot delete folder with subfolders",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Cannot delete folder with subfolders. Please delete or move child folders first."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Folder not found"
          },
          "500": {
            "description": "Failed to delete folder"
          }
        }
      }
    },
    "/data/folders/{id}/breadcrumb": {
      "get": {
        "summary": "Get folder breadcrumb path",
        "tags": [
          "Folders"
        ],
        "description": "Get the folder path from root to the specified folder",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "responses": {
          "200": {
            "description": "Breadcrumb path retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "_id": {
                        "type": "string",
                        "description": "Folder ID"
                      },
                      "name": {
                        "type": "string",
                        "description": "Folder name"
                      },
                      "color": {
                        "type": "string",
                        "description": "Folder color (if set)"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid folder ID"
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to build breadcrumb"
          }
        }
      }
    },
    "/data/folders/{id}/depth": {
      "get": {
        "summary": "Get folder depth level",
        "tags": [
          "Folders"
        ],
        "description": "Get the depth level of a folder (0=root, 1=child, 2=grandchild)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "responses": {
          "200": {
            "description": "Depth level retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "depth": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 2,
                      "description": "Folder depth level (0-2)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid folder ID"
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to calculate folder depth"
          }
        }
      }
    },
    "/data/folders/{id}/isEmpty": {
      "get": {
        "summary": "Check if folder is empty",
        "tags": [
          "Folders"
        ],
        "description": "Check if a folder has no items (creatives, sources, or assets) assigned to it",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "responses": {
          "200": {
            "description": "Empty status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "isEmpty": {
                      "type": "boolean",
                      "description": "True if folder has no items assigned"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid folder ID"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Folder not found"
          },
          "500": {
            "description": "Failed to check folder status"
          }
        }
      }
    },
    "/data/folders/{id}/items": {
      "post": {
        "summary": "Add item to folder",
        "tags": [
          "Folders"
        ],
        "description": "Add a single creative, source, or asset to a folder",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "type",
                  "itemId"
                ],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "creatives",
                      "sources",
                      "assets"
                    ],
                    "description": "The type of item to add"
                  },
                  "itemId": {
                    "type": "string",
                    "pattern": "^[0-9a-fA-F]{24}$",
                    "description": "Item ID (ObjectId)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Item added to folder successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Folder"
                }
              }
            }
          },
          "400": {
            "description": "Invalid folder ID, item type, or item ID"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Folder not found"
          },
          "500": {
            "description": "Failed to add item to folder"
          }
        }
      }
    },
    "/data/folders/{id}/items/{type}/{itemId}": {
      "delete": {
        "summary": "Remove item from folder",
        "tags": [
          "Folders"
        ],
        "description": "Remove a single creative, source, or asset from a folder",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Folder ID (ObjectId)"
          },
          {
            "name": "type",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "creatives",
                "sources",
                "assets"
              ]
            },
            "description": "The type of item to remove"
          },
          {
            "name": "itemId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[0-9a-fA-F]{24}$"
            },
            "description": "Item ID (ObjectId)"
          }
        ],
        "responses": {
          "200": {
            "description": "Item removed from folder successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Folder"
                }
              }
            }
          },
          "400": {
            "description": "Invalid folder ID, item type, or item ID"
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to remove item from folder"
          }
        }
      }
    },
    "/data/folders/bulk-assign": {
      "post": {
        "summary": "Bulk assign items to folder",
        "tags": [
          "Folders"
        ],
        "description": "Assign multiple items to a folder at once. If folderId is null, items are removed from all folders",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "itemType",
                  "itemIds"
                ],
                "properties": {
                  "folderId": {
                    "type": [
                      "string",
                      "null"
                    ],
                    "pattern": "^[0-9a-fA-F]{24}$",
                    "description": "Target folder ID (ObjectId) or null to remove from all folders"
                  },
                  "itemType": {
                    "type": "string",
                    "enum": [
                      "creatives",
                      "sources",
                      "assets"
                    ],
                    "description": "The type of items to assign"
                  },
                  "itemIds": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^[0-9a-fA-F]{24}$"
                    },
                    "minItems": 1,
                    "description": "Array of item IDs (ObjectIds) to assign"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Items assigned successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Items assigned successfully."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid item type, folder ID, or item IDs"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Folder not found"
          },
          "500": {
            "description": "Failed to assign items"
          }
        }
      }
    },
    "components": {
      "schemas": {
        "Folder": {
          "type": "object",
          "properties": {
            "_id": {
              "type": "string",
              "description": "Folder ID (ObjectId)"
            },
            "name": {
              "type": "string",
              "description": "Folder name"
            },
            "owner": {
              "type": "object",
              "properties": {
                "domain": {
                  "type": "string",
                  "description": "Domain ID (ObjectId)"
                },
                "user": {
                  "type": "string",
                  "description": "User ID (ObjectId)"
                }
              },
              "description": "Folder owner information"
            },
            "items": {
              "type": "object",
              "properties": {
                "creatives": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Array of creative IDs (ObjectIds)"
                },
                "sources": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Array of source IDs (ObjectIds)"
                },
                "assets": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Array of asset IDs (ObjectIds)"
                }
              },
              "description": "Items contained in this folder"
            },
            "domains": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Array of domain IDs (ObjectIds) with access"
            },
            "parent": {
              "type": "string",
              "description": "Parent folder ID (ObjectId) - omitted for root folders"
            },
            "attributes": {
              "type": "object",
              "properties": {
                "color": {
                  "type": "string",
                  "description": "Folder color code"
                }
              },
              "description": "Folder attributes"
            },
            "created": {
              "type": "string",
              "format": "date-time",
              "description": "Creation timestamp"
            },
            "updated": {
              "type": "string",
              "format": "date-time",
              "description": "Last update timestamp"
            }
          }
        }
      }
    },
    "/data/sources": {
      "get": {
        "summary": "Get all sources",
        "tags": [
          "Sources"
        ],
        "responses": {
          "200": {
            "description": "Sources data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to retrieve sources"
          }
        }
      },
      "post": {
        "summary": "Create a new source",
        "tags": [
          "Sources"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "The name of the source"
                  },
                  "internal": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string",
                          "description": "The name of the internal source"
                        },
                        "variables": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "required": [
                              "name",
                              "type",
                              "value"
                            ],
                            "properties": {
                              "name": {
                                "type": "string",
                                "description": "Variable name"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "string",
                                  "number",
                                  "boolean",
                                  "date",
                                  "date-time",
                                  "time",
                                  "array",
                                  "object"
                                ],
                                "description": "The data type of the variable"
                              },
                              "value": {
                                "type": "string",
                                "description": "The value of the variable (stored as string)"
                              },
                              "description": {
                                "type": "string",
                                "description": "Variable description (optional)"
                              }
                            }
                          },
                          "description": "Array of typed variables with values (no path field)"
                        }
                      }
                    },
                    "description": "Array of internal sources with variables"
                  },
                  "external": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name",
                        "source",
                        "lifetime",
                        "timeout",
                        "pattern"
                      ],
                      "properties": {
                        "name": {
                          "type": "string",
                          "description": "The name of the endpoint"
                        },
                        "source": {
                          "type": "string",
                          "description": "The URL of the endpoint"
                        },
                        "lifetime": {
                          "type": "integer",
                          "description": "Cache TTL in seconds"
                        },
                        "timeout": {
                          "type": "integer",
                          "description": "Lock timeout in seconds"
                        },
                        "pattern": {
                          "type": "object",
                          "description": "JSON Schema pattern for response validation"
                        },
                        "status": {
                          "type": "string",
                          "description": "Validation status (optional)"
                        },
                        "variables": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "required": [
                              "path",
                              "name"
                            ],
                            "properties": {
                              "path": {
                                "type": "string",
                                "description": "JSONPath or dot notation path to data node"
                              },
                              "name": {
                                "type": "string",
                                "description": "Variable name for mapping"
                              },
                              "type": {
                                "type": "string",
                                "description": "Data type (optional)"
                              },
                              "description": {
                                "type": "string",
                                "description": "Variable description (optional)"
                              }
                            }
                          },
                          "description": "Variable mappings for data extraction (has path, no value)"
                        }
                      }
                    },
                    "description": "Array of external endpoint configurations"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Source created successfully"
          },
          "400": {
            "description": "Bad request - missing required fields"
          },
          "401": {
            "description": "Unauthorized"
          },
          "500": {
            "description": "Failed to create source"
          }
        }
      }
    },
    "/data/sources/{id}": {
      "get": {
        "summary": "Get source by ID",
        "tags": [
          "Sources"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The source's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Source data retrieved"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Source not found"
          },
          "500": {
            "description": "Failed to retrieve source"
          }
        }
      },
      "put": {
        "summary": "Update source by ID",
        "tags": [
          "Sources"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The source's MongoDB _id"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "The name of the source"
                  },
                  "internal": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string",
                          "description": "The name of the internal source"
                        },
                        "variables": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "required": [
                              "name",
                              "type",
                              "value"
                            ],
                            "properties": {
                              "name": {
                                "type": "string",
                                "description": "Variable name"
                              },
                              "type": {
                                "type": "string",
                                "enum": [
                                  "string",
                                  "number",
                                  "boolean",
                                  "date",
                                  "date-time",
                                  "time",
                                  "array",
                                  "object"
                                ],
                                "description": "The data type of the variable"
                              },
                              "value": {
                                "type": "string",
                                "description": "The value of the variable (stored as string)"
                              },
                              "description": {
                                "type": "string",
                                "description": "Variable description (optional)"
                              }
                            }
                          },
                          "description": "Array of typed variables with values (no path field)"
                        }
                      }
                    },
                    "description": "Array of internal sources with variables"
                  },
                  "external": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name",
                        "source",
                        "lifetime",
                        "timeout",
                        "pattern"
                      ],
                      "properties": {
                        "name": {
                          "type": "string",
                          "description": "The name of the endpoint"
                        },
                        "source": {
                          "type": "string",
                          "description": "The URL of the endpoint"
                        },
                        "lifetime": {
                          "type": "integer",
                          "description": "Cache TTL in seconds"
                        },
                        "timeout": {
                          "type": "integer",
                          "description": "Lock timeout in seconds"
                        },
                        "pattern": {
                          "type": "object",
                          "description": "JSON Schema pattern for response validation"
                        },
                        "status": {
                          "type": "string",
                          "description": "Validation status (optional)"
                        },
                        "variables": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "required": [
                              "path",
                              "name"
                            ],
                            "properties": {
                              "path": {
                                "type": "string",
                                "description": "JSONPath or dot notation path to data node"
                              },
                              "name": {
                                "type": "string",
                                "description": "Variable name for mapping"
                              },
                              "type": {
                                "type": "string",
                                "description": "Data type (optional)"
                              },
                              "description": {
                                "type": "string",
                                "description": "Variable description (optional)"
                              }
                            }
                          },
                          "description": "Variable mappings for data extraction (has path, no value)"
                        }
                      }
                    },
                    "description": "Array of external endpoint configurations"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Source updated successfully"
          },
          "400": {
            "description": "Bad request - invalid data"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Source not found"
          },
          "500": {
            "description": "Failed to update source"
          }
        }
      },
      "delete": {
        "summary": "Delete source by ID",
        "tags": [
          "Sources"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The source's MongoDB _id"
          }
        ],
        "responses": {
          "200": {
            "description": "Source deleted successfully"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Source not found"
          },
          "500": {
            "description": "Failed to delete source"
          }
        }
      }
    },
    "/data/sources/{sourceId}/{endpointId}": {
      "get": {
        "summary": "Get internal variable or proxy request to external source with caching",
        "tags": [
          "Sources"
        ],
        "parameters": [
          {
            "name": "sourceId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The source's MongoDB _id"
          },
          {
            "name": "endpointId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The internal variable or external endpoint's MongoDB _id"
          },
          {
            "name": "forceUpdate",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false
            },
            "description": "Force cache update by bypassing cache check and fetching fresh data (external endpoints only)"
          },
          {
            "name": "readOnly",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false
            },
            "description": "Return only buffer metadata without triggering cache logic (external endpoints only)"
          }
        ],
        "responses": {
          "200": {
            "description": "Internal variable data or full buffer document with cached data and metadata",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "description": "Internal variable response",
                      "properties": {
                        "name": {
                          "type": "string",
                          "description": "Variable name"
                        },
                        "value": {
                          "type": "string",
                          "description": "Variable value"
                        },
                        "type": {
                          "type": "string",
                          "description": "Variable type"
                        },
                        "description": {
                          "type": "string",
                          "description": "Variable description"
                        },
                        "_id": {
                          "type": "string",
                          "description": "Variable ID"
                        }
                      }
                    },
                    {
                      "type": "object",
                      "description": "External endpoint buffer document",
                      "properties": {
                        "_id": {
                          "type": "string",
                          "description": "Buffer document ID (same as endpoint ID)"
                        },
                        "data": {
                          "type": "object",
                          "description": "Cached response data from external API"
                        },
                        "timestamp": {
                          "type": "string",
                          "format": "date-time",
                          "description": "When data was cached"
                        },
                        "httpStatus": {
                          "type": "integer",
                          "description": "HTTP status from external API"
                        },
                        "errorState": {
                          "type": "string",
                          "description": "Error information if applicable"
                        },
                        "created": {
                          "type": "string",
                          "format": "date-time",
                          "description": "When buffer was created"
                        },
                        "updated": {
                          "type": "string",
                          "format": "date-time",
                          "description": "When buffer was last updated"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Source or endpoint not found"
          },
          "429": {
            "description": "Request already in progress"
          },
          "500": {
            "description": "Failed to fetch external data"
          },
          "502": {
            "description": "Response validation failed"
          }
        }
      }
    },
    "/data/users/create": {
      "post": {
        "summary": "Register a new user",
        "tags": [
          "Users"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "name": {
                    "type": "string"
                  }
                },
                "required": [
                  "username",
                  "password",
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully"
          },
          "400": {
            "description": "Username, password, and name required"
          },
          "409": {
            "description": "Username already exists"
          },
          "500": {
            "description": "Error registering user"
          }
        }
      }
    },
    "/data/users/reset/{id}": {
      "patch": {
        "summary": "Reset user password",
        "tags": [
          "Users"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The user's MongoDB _id"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "newPassword": {
                    "type": "string",
                    "format": "password"
                  }
                },
                "required": [
                  "username",
                  "newPassword"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset successfully"
          },
          "400": {
            "description": "Username and newPassword required"
          },
          "404": {
            "description": "User not found"
          },
          "500": {
            "description": "Error resetting password"
          }
        }
      }
    },
    "/data/users/edit/{id}": {
      "put": {
        "summary": "Edit user fields",
        "tags": [
          "Users"
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The user's MongoDB _id"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated successfully"
          },
          "400": {
            "description": "User ID and at least one field to update are required"
          },
          "404": {
            "description": "User not found"
          },
          "500": {
            "description": "Error updating user"
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/files/assets/{filename}.{extension}": {
      "get": {
        "summary": "Get media files",
        "tags": [
          "Files"
        ],
        "parameters": [
          {
            "name": "filename",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The asset's filename"
          },
          {
            "name": "extension",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "The asset's extension"
          }
        ],
        "responses": {
          "200": {
            "description": "Media files retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/files/assets/": {
      "post": {
        "summary": "Upload media files",
        "tags": [
          "Files"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "files": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    },
                    "description": "The source files"
                  }
                },
                "required": [
                  "files"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Media files uploaded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "asset": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/files/logs": {
      "post": {
        "summary": "Post log records",
        "tags": [
          "Files"
        ],
        "description": "Submits new log records to the system.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "level": {
                    "type": "string",
                    "description": "The log level (e.g., \"info\", \"warn\", \"error\").",
                    "example": "info"
                  },
                  "message": {
                    "type": "string",
                    "description": "The log message.",
                    "example": "Sample message."
                  },
                  "meta": {
                    "type": "object",
                    "description": "Additional metadata for the log entry.",
                    "example": {}
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Log record successfully posted.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "success"
                    },
                    "message": {
                      "type": "string",
                      "example": "Log record received."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request body.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "error"
                    },
                    "message": {
                      "type": "string",
                      "example": "Invalid input data."
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}